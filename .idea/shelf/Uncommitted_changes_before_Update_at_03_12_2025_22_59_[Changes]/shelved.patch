Index: clases/paquetes.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># from os.path import altsep\r\n#\r\n# from json.scanner import NUMBER_RE\r\n\r\nimport pyxel\r\n\r\n# REFACTOR: Eliminar NUM_CINTAS y SEP_ENTRE_CINTAS? --> No importarlas, usarlas como atributos?\r\nfrom utils.config import cintaPar, WIDTH, HEIGHT, NUM_CINTAS, COLORES\r\nfrom clases.elemento import Elemento\r\n\r\n\r\nclass Paquetes(Elemento):\r\n    def __init__(self, inicioX, inicioY, anchoPaq, altoPaq, color, anchoCinta, altoCinta, longitudX, longitudY, SEP_ENTRE_CINTAS):\r\n        \"\"\"\r\n        En este caso, los atributos heredados de Elemento indican lo siguiente:\r\n        - posX: posicion en el eje X donde se empiezan a dibujar las cintas/paquetes\r\n        - posY: posicion en el eje Y donde se empiezan a dibujar las cintas/paquetes\r\n        - ancho: Anchura de las paquetes\r\n        - alto: Altura total del conjunto de paquetes\r\n        - color: Color de las paquetes\r\n        \"\"\"\r\n        # altoCintas = NUM_CINTAS * SEP_ENTRE_CINTAS\r\n        super().__init__(inicioX, inicioY, anchoPaq, altoPaq, color)\r\n        # minY = 25\r\n        # inicioCinta, finCinta = 60, 200\r\n        self.longitudX = longitudX\r\n        self.longitudY = longitudY\r\n\r\n        # self.anchoPaq = 7\r\n        # self.altoPaq = 4\r\n        self.anchoCinta = anchoCinta\r\n        self.altoCinta = altoCinta\r\n        self.colorCinta = COLORES[\"naranja\"]\r\n\r\n        self.sepEntrePaqs = (anchoCinta - self.ancho) / self.longitudX\r\n        self.sepEntreCintas = SEP_ENTRE_CINTAS\r\n\r\n        # Creamos la matriz con los paquetes\r\n        self.matriz = self.crearMatriz(longitudX, longitudY)\r\n        # Creamos la lista de 1D con los paquetes de la cinta 0\r\n        self.crearlista0()\r\n        self.cinta0_x = 220\r\n\r\n    @property\r\n    def longitudX(self):\r\n        return self.__longitudX\r\n\r\n    @longitudX.setter\r\n    def longitudX(self, valor):\r\n        if isinstance(valor, int) and valor > 0:\r\n            self.__longitudX = valor\r\n        else:\r\n            raise TypeError(\"LongitudX debe ser un entero positivo\")\r\n\r\n    @property\r\n    def longitudY(self):\r\n        return self.__longitudY\r\n\r\n    @longitudY.setter\r\n    def longitudY(self, valor):\r\n        if isinstance(valor, int) and valor > 0:\r\n            self.__longitudY = valor\r\n        else:\r\n            raise TypeError(\"LongitudY debe ser un entero positivo\")\r\n\r\n    def crearMatriz(self, longitudX, longitudY):\r\n        matriz = []\r\n        for y in range(longitudY):\r\n            fila = []\r\n            for x in range(longitudX):\r\n                fila.append(0)\r\n            matriz.append(fila)\r\n        return matriz\r\n\r\n    def crearlista0(self):\r\n        self.lista0 = []\r\n        #for x in range(self.longitudX):\r\n        for x in range(200): #no cambi mucho la velocidad, fíjate\r\n            self.lista0.append(0)\r\n        print(\"lista0\", self.lista0)\r\n\r\n    def funcionesLista0(self):\r\n        # Añade paquete\r\n        self.lista0[-1] = 1 #Añade un paquete en la posición de indice más grande de la lista0 (a la izquierda)\r\n\r\n\r\n    def actualizarPaquetes(self):\r\n        # Busca los paquetes (unos) dentro de la matriz y los mueve a su siguiente posición\r\n        for y in range(self.longitudY):\r\n            filaActual = self.matriz[y]\r\n            # Movemos las cintas hacia la 'derecha'. Para eso, revertimos las cintas pares (se mueven hacia la izquierda)\r\n            if cintaPar(y):\r\n                # Cinta par\r\n                filaActual.reverse()\r\n            # Se evalúa primero el último elemento de la lista\r\n            x = self.longitudX - 1\r\n            if filaActual[x] == 1:\r\n                # Subimos el paquete al lado correcto\r\n                self.subirPaquete(x, y)\r\n                # Eliminamos la posición actual del paquete de la variable 'filaActual'\r\n                filaActual[x] = 0\r\n\r\n            # Comprobamos cada posición de la fila y movemos los paquetes\r\n            # Bucle inverso desde el penúltimo elemento hasta el primero (índice 0)\r\n            for x in range(self.longitudX - 2, -1, -1):\r\n                if filaActual[x] == 1:\r\n                    filaActual = self.moverDcha(filaActual, x, y)\r\n            # Le damos la vuelta otra vez, si es necesario\r\n            if cintaPar(y):\r\n                filaActual.reverse()\r\n            self.matriz[y] = filaActual\r\n\r\n        # -- Mover paquetes de la cinta 0 --\r\n        # Comprueba indices donde hay unos y los mueve hacia la izquierda\r\n        for i in range(1, len(self.lista0)):\r\n            if self.lista0[i] == 1:\r\n                self.lista0[i] = 0\r\n                self.lista0[i - 1] = 1\r\n\r\n        # Comprobar si ya hay un paquete listo para entrar en la matriz\r\n        if self.lista0[0] == 1:\r\n            self.lista0[0] = 0\r\n            self.matriz[-1][-1] = 1\r\n\r\n    def moverDcha(self, fila, x, y):\r\n        # -- Mueve un paquete a la siguiente posición --\r\n        if x + 1 < self.longitudX:\r\n            # Movemos la posición del paquete de (x, y) a (x + 1, y)\r\n            fila[x] = 0\r\n            fila[x + 1] = 1\r\n        else:\r\n            print(\"ERROR: Paquete al final, se debería haber subido\")\r\n        return fila\r\n\r\n    def subirPaquete(self, x, y):\r\n        if y != 0:\r\n            self.matriz[y][x] = 0\r\n            # Subimos el paquete al lado que corresponde (a la izquierda en las pares, a la derecha en las impares)\r\n            if cintaPar(y - 1):\r\n                self.matriz[y - 1][x] = 1\r\n            else:\r\n                self.matriz[y - 1][0] = 1\r\n        # else:\r\n        #     print(\"=\" * 10, \"Paquete en la última posición, listo para entrar al camión\", \"=\" * 10)\r\n\r\n    # Añade un paquete al principio de las cintas\r\n    def anadirPaqInicio(self):\r\n        # x = self.longitudX - 1\r\n        # y = self.longitudY - 1\r\n        # self.matriz[y][x] = 1\r\n        self.funcionesLista0()\r\n        print(self.lista0)\r\n\r\n    def draw(self):\r\n        # minY = 25\r\n        # inicioCinta, finCinta = 60, 200\r\n        # altoCinta = 5\r\n        # y = minY + (self.longitudY - 1) * SEP_ENTRE_CINTAS\r\n        # -- Dibujamos la lista 0 de paquetes --\r\n        ## Dibujamos los paquetes de la lista 0\r\n        x = self.cinta0_x\r\n        ## La lista 0 debe estar a la altura de la última cinta de paquetes\r\n        y = self.posY + (self.longitudY - 1) * self.sepEntreCintas\r\n        for i in range(len(self.lista0)):\r\n            paq = self.lista0[i]\r\n            if paq == 1:\r\n                pyxel.rect(x, y - self.alto, self.ancho, self.alto, self.color)\r\n            x += self.sepEntrePaqs\r\n\r\n        ## Dibujamos la cinta 0\r\n        pyxel.rect(self.cinta0_x, y, 200, self.altoCinta, self.colorCinta)\r\n        pyxel.rect(self.cinta0_x + 30, y - 10, 50, 10, COLORES[\"negro\"])\r\n        pyxel.rect(self.cinta0_x + 32, y - 8, 6, 5, COLORES[\"magenta\"])\r\n        pyxel.rect(self.cinta0_x + 5, y , 40, 1, COLORES[\"gris\"])\r\n\r\n\r\n        # -- Dibujamos las cintas --\r\n        y = self.posY\r\n        for j in range(self.longitudY):\r\n            pyxel.rect(self.posX, y, self.anchoCinta, self.altoCinta, self.colorCinta)\r\n            pyxel.rect(self.posX + 5, y , self.anchoCinta -10, self.altoCinta -3, COLORES[\"gris\"])\r\n            pyxel.rect(self.posX - 15, y + 3, self.anchoCinta - 125, self.altoCinta - 3, COLORES[\"marron\"])\r\n            pyxel.rect(self.posX + 140, y + 3, self.anchoCinta - 125, self.altoCinta - 3, COLORES[\"marron\"])\r\n\r\n            y += self.sepEntreCintas\r\n\r\n        # -- Dibujamos los paquetes de la matriz --\r\n        ## Cada paquete puede estar en una posición de la matriz, de dimensiones (longitudX, longitudY)\r\n        x = self.posX\r\n        for i in range(self.longitudX):\r\n            y = self.posY\r\n            for j in range(self.longitudY):\r\n                if self.matriz[j][i] == 1:\r\n                    pyxel.rect(x, y - self.alto, self.ancho, self.alto, self.color)\r\n                # else:\r\n                #     pyxel.rectb(x, y - self.alto, self.ancho, self.alto, self.color)\r\n                # Pasamos a dibujar el siguiente paquete (de arriba a abajo, el inferior)\r\n                y += self.sepEntreCintas\r\n            # Después de recorrer toda la columna, pasar a la siguiente (de izquiera a derecha)\r\n            x += self.sepEntrePaqs\r\n\r\n    \r\n    def __paqsEnJuego(self):\r\n        # Cuenta cuantos paquetes hay actualmente en juego\r\n        sum = 0\r\n        for y in range(self.longitudY):\r\n            for x in range(self.longitudX):\r\n                if self.matriz[y][x] == 1:\r\n                    sum += 1\r\n        return sum\r\n\r\n    # DEBUG\r\n    def __str__(self):\r\n        txt = \"\"\r\n        for fila in self.matriz:\r\n            txt += str(fila) + \"\\n\"\r\n        return txt\r\n\r\n    def __repr__(self):\r\n        return f\"Paquete(longitudX={self.longitudX}, longitudY={self.longitudY}, matrizPaquetes={self.matriz})\"\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/clases/paquetes.py b/clases/paquetes.py
--- a/clases/paquetes.py	(revision e7b5479b06b665a40557f5f290dc6a66793dad66)
+++ b/clases/paquetes.py	(date 1764798874861)
@@ -172,6 +172,8 @@
         pyxel.rect(self.cinta0_x + 30, y - 10, 50, 10, COLORES["negro"])
         pyxel.rect(self.cinta0_x + 32, y - 8, 6, 5, COLORES["magenta"])
         pyxel.rect(self.cinta0_x + 5, y , 40, 1, COLORES["gris"])
+        pyxel.rect(self.cinta0_x - 5, y + 3, 5, 1, COLORES["marron"])
+
 
 
         # -- Dibujamos las cintas --
Index: clases/camion.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import pyxel\r\n\r\nfrom utils.config import NUM_CINTAS, COLORES\r\nfrom clases.elemento import Elemento\r\n\r\nclass Camion(Elemento):\r\n    def __init__(self, posX, posY, ancho, alto, color):\r\n        super().__init__(posX, posY, ancho, alto, color)\r\n        self.carga = 0\r\n        # Posición inicial, donde carga los paquetes\r\n        self.posicionCarga = posX\r\n        # Posición fuera de la pantalla, donde descarga los paquetes\r\n        self.posicionDescarga = -40\r\n        self.velocidadCamion = 3\r\n        self.velocidadCamionRetroceso = 1.5\r\n        # -1 si va hacia la izda, 0 si está quieto y 1 si va a la dcha\r\n        self.dirMov = 0\r\n    @property\r\n    def carga(self):\r\n        return self.__carga\r\n    @carga.setter\r\n    def carga(self, valor):\r\n        if isinstance(valor, int) and valor >= 0:\r\n            self.__carga = valor\r\n        else:\r\n            raise TypeError(\"La carga debe ser un entero positivo\")\r\n\r\n\r\n    def mover_y_descargar(self):\r\n        # Condición inicial para que se empieze a mover\r\n        if self.carga >= 8:\r\n            self.dirMov = -1\r\n        if self.dirMov != 0:\r\n            if self.posX > self.posicionDescarga and self.dirMov == -1: #por ejemplo (tiene que estar fuera de la pantalla)\r\n                self.posX -= self.velocidadCamion #Izquierda. En funcion de esto irá mas o menos rápido\r\n            elif self.posX <= self.posicionDescarga:\r\n                self.carga = 0\r\n                self.dirMov = 1\r\n\r\n            if self.posX < self.posicionCarga and self.dirMov == 1:\r\n                self.posX += self.velocidadCamionRetroceso\r\n            elif self.posX >= self.posicionCarga:\r\n                self.dirMov = 0\r\n\r\n\r\n    \r\n    def draw(self):\r\n        # -- Pinta el camión y los paquetes --\r\n        # Camión\r\n        pyxel.rect(self.posX, self.posY, self.ancho, self.alto, self.color)\r\n        # Ruedas\r\n        pyxel.rect(self.posX +1, self.posY +2, self.ancho -25, self.alto, COLORES[\"negro\"])\r\n        pyxel.rect(self.posX+25, self.posY +2, self.ancho - 25, self.alto, COLORES[\"negro\"])\r\n        # Paquetes dentro del camión\r\n        pyxel.rect(self.posX, self.posY - 5, self.ancho * (self.carga / 8), self.alto, COLORES[\"rosa\"])\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/clases/camion.py b/clases/camion.py
--- a/clases/camion.py	(revision e7b5479b06b665a40557f5f290dc6a66793dad66)
+++ b/clases/camion.py	(date 1764799109230)
@@ -50,6 +50,8 @@
         pyxel.rect(self.posX, self.posY, self.ancho, self.alto, self.color)
         # Ruedas
         pyxel.rect(self.posX +1, self.posY +2, self.ancho -25, self.alto, COLORES["negro"])
+        pyxel.rect(self.posX + 3, self.posY + 4, self.ancho - 29, self.alto -4, COLORES["gris"])
         pyxel.rect(self.posX+25, self.posY +2, self.ancho - 25, self.alto, COLORES["negro"])
+        pyxel.rect(self.posX + 27, self.posY + 4, self.ancho - 29, self.alto -4, COLORES["gris"])
         # Paquetes dentro del camión
         pyxel.rect(self.posX, self.posY - 5, self.ancho * (self.carga / 8), self.alto, COLORES["rosa"])
